---
- name: Check if ansible version is equal or greater than 2.11
  ansible.builtin.fail:
    msg: "Ansible core should be equal or greater than 2.11"
  when: ansible_version.full is ansible.builtin.version('2.11','<')

- name: Check if python is equal or greater than 3
  ansible.builtin.fail:
    msg: "Python should be equal or greater than 3"
  when: ansible_python.version.major is ansible.builtin.version('3','<')

# tasks file for samba
- name: Install samba services
  ansible.builtin.include_tasks: "{{ ansible_pkg_mgr }}.yml"
  tags: samba_install

- name: Set samba_config_params parameter
  set_fact:
    samba_config_params: "{{ samba_config_params_default | community.general.lists_mergeby(samba_config_params_group_all | default([]),samba_config_params_group | default([]),samba_config_params_host | default([]), 'name', recursive=true) }}"
- name: Config samba
  ansible.builtin.template:
    src: "{{ samba_templates_dir }}/smb.conf.j2"
    dest: "{{ samba_config_file }}"
    validate: "testparm -s %s"

- name: Enable and start samba after configure
  ansible.builtin.service:
    name: "{{ item }}"
    enabled: true
    state: "restarted"
  loop: "{{ samba_services }}"
  when: samba_is_server is defined and samba_is_server | bool
